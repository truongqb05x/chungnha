<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bếp Chung - Trò chuyện</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Light theme colors */
            --primary: #FF6D28;
            --primary-light: #FF9F45;
            --primary-dark: #E14D2A;
            --secondary: #3A8891;
            --success: #28A745;
            --error: #DC3545;
            --warning: #FD7E14;
            --info: #17A2B8;
            
            --text: #2D3436;
            --text-light: #636E72;
            --text-lighter: #B2BEC3;
            --text-white: #FFFFFF;
            
            --bg: #F5F6FA;
            --card-bg: #FFFFFF;
            --border: #DFE6E9;
            --hover: #F8F9FA;
            
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 14px;
            
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            
            --transition: all 0.2s ease;
        }
        
        [data-theme="dark"] {
            --primary: #FF6D28;
            --primary-light: #FF9F45;
            --primary-dark: #E14D2A;
            --secondary: #3A8891;
            
            --text: #ECF0F1;
            --text-light: #BDC3C7;
            --text-lighter: #7F8C8D;
            --text-white: #FFFFFF;
            
            --bg: #1A1A1A;
            --card-bg: #2D3436;
            --border: #3D484A;
            --hover: #3D484A;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            line-height: 1.5;
            transition: var(--transition);
        }
        
        /* App container */
        .app-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            grid-template-rows: 70px 1fr;
            min-height: 100vh;
        }
        
        /* Header */
        .header {
            grid-column: 2 / 3;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            background-color: var(--card-bg);
            box-shadow: var(--shadow-sm);
            z-index: 10;
        }
        
        .mobile-menu-btn {
            display: none;
            font-size: 1.25rem;
            cursor: pointer;
            color: var(--text);
        }
        
        .header-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        
        .header-icon {
            position: relative;
            cursor: pointer;
            color: var(--text-light);
            transition: var(--transition);
        }
        
        .header-icon:hover {
            color: var(--primary);
        }
        
        .badge {
            position: absolute;
            top: -6px;
            right: -6px;
            background-color: var(--error);
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            cursor: pointer;
        }
        
        /* Sidebar */
        .sidebar {
            grid-column: 1 / 2;
            grid-row: 1 / 3;
            display: flex;
            flex-direction: column;
            background-color: var(--card-bg);
            box-shadow: var(--shadow-sm);
            padding: 1.5rem 0;
            height: 100vh;
            position: sticky;
            top: 0;
            transition: var(--transition);
            z-index: 20;
        }
        
        .sidebar-header {
            display: flex;
            align-items: center;
            padding: 0 1.5rem 1.5rem;
            border-bottom: 1px solid var(--border);
            margin-bottom: 1.5rem;
        }
        
        .sidebar-logo {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            margin-right: 0.75rem;
        }
        
        .sidebar-title {
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .sidebar-group {
            font-size: 0.85rem;
            color: var(--text-light);
        }
        
        .sidebar-nav {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
            padding: 0 1rem;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: var(--radius-sm);
            text-decoration: none;
            color: var(--text-light);
            transition: var(--transition);
        }
        
        .nav-item:hover {
            background-color: var(--hover);
            color: var(--primary);
        }
        
        .nav-item.active {
            background-color: rgba(255, 109, 40, 0.1);
            color: var(--primary);
        }
        
        .nav-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.75rem;
            font-size: 1rem;
        }
        
        .nav-text {
            font-size: 0.95rem;
            font-weight: 500;
        }
        
        .sidebar-footer {
            padding: 1.5rem 1.5rem 0;
            border-top: 1px solid var(--border);
            margin-top: auto;
        }
        
        .theme-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: var(--hover);
            border-radius: var(--radius-md);
            padding: 0.25rem;
        }
        
        .theme-btn {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.5rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
            color: var(--text-light);
            transition: var(--transition);
        }
        
        .theme-btn.active {
            background-color: var(--primary);
            color: white;
        }
        
        /* Main content */
        .main-content {
            grid-column: 2 / 3;
            padding: 2rem;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 1.5rem;
        }
        
        /* Chat page styles */
        .chat-container {
            display: contents;
        }
        
        .member-list {
            background-color: var(--card-bg);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            padding: 1.5rem;
            height: calc(100vh - 140px);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .member-list-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        
        .member-list-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text);
        }
        
        .search-container {
            position: relative;
            margin-bottom: 1.5rem;
        }
        
        .search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            font-size: 0.95rem;
            background-color: var(--card-bg);
            color: var(--text);
            transition: var(--transition);
        }
        
        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(255, 109, 40, 0.1);
        }
        
        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
        }
        
        .member-scroll-container {
            flex: 1;
            overflow-y: auto;
            padding-right: 0.5rem;
        }
        
        .member-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            margin-bottom: 0.5rem;
        }
        
        .member-item:hover {
            background-color: var(--hover);
        }
        
        .member-item.active {
            background-color: rgba(255, 109, 40, 0.1);
        }
        
        .member-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: 600;
            margin-right: 0.75rem;
            flex-shrink: 0;
        }
        
        .member-info {
            flex: 1;
            min-width: 0;
        }
        
        .member-name {
            font-size: 0.95rem;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .member-last-msg {
            font-size: 0.85rem;
            color: var(--text-light);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .member-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            margin-left: 0.5rem;
        }
        
        .member-time {
            font-size: 0.75rem;
            color: var(--text-light);
        }
        
        .member-badge {
            background-color: var(--primary);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 600;
            margin-top: 0.25rem;
        }
        
        .chat-area {
            background-color: var(--card-bg);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            display: flex;
            flex-direction: column;
            height: calc(100vh - 140px);
        }
        
        .chat-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .chat-title-container {
            display: flex;
            align-items: center;
        }
        
        .chat-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--secondary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: 600;
            margin-right: 0.75rem;
        }
        
        .chat-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text);
        }
        
        .chat-subtitle {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }
        
        .chat-actions {
            display: flex;
            gap: 1rem;
        }
        
        .chat-action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--hover);
            color: var(--text-light);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .chat-action-btn:hover {
            background-color: var(--primary);
            color: white;
        }
        
        .chat-messages-container {
            flex: 1;
            overflow: hidden;
            position: relative;
        }
        
        .chat-messages {
            padding: 1.5rem;
            overflow-y: auto;
            height: 100%;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .message-date {
            text-align: center;
            margin: 1rem 0;
            position: relative;
        }
        
        .message-date::before {
            content: "";
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background-color: var(--border);
            z-index: -1;
        }
        
        .message-date span {
            background-color: var(--card-bg);
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-lg);
            font-size: 0.8rem;
            color: var(--text-light);
            border: 1px solid var(--border);
        }
        
        .message {
            max-width: 70%;
            padding: 0.75rem 1rem;
            border-radius: var(--radius-md);
            font-size: 0.95rem;
            line-height: 1.4;
            position: relative;
        }
        
        .message.sent {
            background-color: var(--primary);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }
        
        .message.received {
            background-color: var(--hover);
            color: var(--text);
            align-self: flex-start;
            border-bottom-left-radius: 4px;
        }
        
        .message.sent .message-sender {
            display: none;
        }
        
        .message.received .message-sender {
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 0.25rem;
            color: var(--primary);
        }
        
        .message-timestamp {
            font-size: 0.75rem;
            color: var(--text-lighter);
            margin-top: 0.25rem;
            text-align: right;
        }
        
        .message.received .message-timestamp {
            color: var(--text-light);
        }
        
        .message-status {
            margin-left: 0.5rem;
            font-size: 0.7rem;
        }
        
        .message.sent .message-status {
            color: rgba(255, 255, 255, 0.7);
        }
        
        .chat-input-container {
            padding: 1.5rem;
            border-top: 1px solid var(--border);
            background-color: var(--card-bg);
            border-bottom-left-radius: var(--radius-md);
            border-bottom-right-radius: var(--radius-md);
        }
        
        .message-input-container {
            display: flex;
            align-items: center;
            background-color: var(--bg);
            border-radius: var(--radius-lg);
            padding: 0.5rem 1rem;
        }
        
        .attachment-btn {
            color: var(--text-light);
            cursor: pointer;
            margin-right: 0.75rem;
            transition: var(--transition);
        }
        
        .attachment-btn:hover {
            color: var(--primary);
        }
        
        .chat-input {
            flex: 1;
            border: none;
            background: transparent;
            padding: 0.75rem 0;
            font-size: 0.95rem;
            color: var(--text);
            resize: none;
            max-height: 120px;
        }
        
        .chat-input:focus {
            outline: none;
        }
        
        .send-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 0.75rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .send-btn:hover {
            background-color: var(--primary-dark);
        }
        
        .send-btn:disabled {
            background-color: var(--text-lighter);
            cursor: not-allowed;
        }
        
        .input-actions {
            display: flex;
            align-items: center;
            margin-top: 0.75rem;
            gap: 1rem;
        }
        
        .input-action {
            display: flex;
            align-items: center;
            font-size: 0.85rem;
            color: var(--text-light);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .input-action:hover {
            color: var(--primary);
        }
        
        .input-action i {
            margin-right: 0.5rem;
            font-size: 1rem;
        }
        
        /* Empty state */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            text-align: center;
            padding: 2rem;
            color: var(--text-light);
        }
        
        .empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: var(--border);
        }
        
        .empty-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text);
        }
        
        .empty-text {
            max-width: 400px;
            margin-bottom: 1.5rem;
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 280px 1fr;
            }
        }
        
        @media (max-width: 992px) {
            .app-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto 1fr;
            }
            
            .header {
                grid-column: 1 / 2;
                padding: 1rem;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .sidebar {
                grid-column: 1 / 2;
                grid-row: 2 / 3;
                height: auto;
                position: static;
                display: none;
                padding: 1rem 0;
            }
            
            .sidebar.active {
                display: flex;
            }
            
            .main-content {
                grid-column: 1 / 2;
                grid-row: 3 / 4;
                padding: 1.5rem;
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .member-list {
                height: auto;
                max-height: 400px;
            }
            
            .chat-area {
                height: auto;
                min-height: 500px;
            }
        }
        
        @media (max-width: 768px) {
            .main-content {
                padding: 1rem;
            }
            
            .member-list {
                padding: 1rem;
            }
            
            .chat-header {
                padding: 1rem;
            }
            
            .chat-messages {
                padding: 1rem;
            }
            
            .chat-input-container {
                padding: 1rem;
            }
        }
        
        @media (max-width: 576px) {
            .header-title {
                font-size: 1.25rem;
            }
            
            .header-actions {
                gap: 1rem;
            }
            
            .chat-title {
                font-size: 1.1rem;
            }
            
            .message {
                max-width: 85%;
            }
            
            .chat-actions {
                gap: 0.5rem;
            }
            
            .chat-action-btn {
                width: 32px;
                height: 32px;
                font-size: 0.9rem;
            }
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--text-lighter);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-light);
        }
        
        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }
        
        /* Typing indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            background-color: var(--hover);
            border-radius: var(--radius-md);
            align-self: flex-start;
            margin-bottom: 0.5rem;
            max-width: 120px;
        }
        
        .typing-dots {
            display: flex;
            align-items: center;
            height: 20px;
        }
        
        .typing-dot {
            width: 6px;
            height: 6px;
            background-color: var(--text-light);
            border-radius: 50%;
            margin: 0 2px;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="mobile-menu-btn">
                <i class="fas fa-bars"></i>
            </div>
            <h1 class="header-title">Trò chuyện</h1>
            <div class="header-actions">
                <div class="header-icon">
                    <i class="fas fa-bell"></i>
                    <span class="badge">3</span>
                </div>
                <div class="header-icon theme-icon">
                    <i class="fas fa-moon"></i>
                </div>
                <div class="user-avatar">NM</div>
            </div>
        </header>

        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <i class="fas fa-utensils"></i>
                </div>
                <div>
                    <div class="sidebar-title">Bếp Chung</div>
                    <div class="sidebar-group">Nhóm: Nhà Mình A2</div>
                </div>
            </div>

            <div class="sidebar-nav">
                <a href="#" class="nav-item">
                    <div class="nav-icon">
                        <i class="fas fa-home"></i>
                    </div>
                    <div class="nav-text">Trang chủ</div>
                </a>
                <a href="#" class="nav-item">
                    <div class="nav-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="nav-text">Thành viên</div>
                </a>
                <a href="#" class="nav-item">
                    <div class="nav-icon">
                        <i class="fas fa-book"></i>
                    </div>
                    <div class="nav-text">Thực đơn</div>
                </a>
                <a href="#" class="nav-item">
                    <div class="nav-icon">
                        <i class="fas fa-shopping-cart"></i>
                    </div>
                    <div class="nav-text">Đi chợ</div>
                </a>
                <a href="#" class="nav-item">
                    <div class="nav-icon">
                        <i class="fas fa-wallet"></i>
                    </div>
                    <div class="nav-text">Chi phí</div>
                </a>
                <a href="#" class="nav-item">
                    <div class="nav-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="nav-text">Lịch nấu ăn</div>
                </a>
                <a href="#" class="nav-item">
                    <div class="nav-icon">
                        <i class="fas fa-chart-bar"></i>
                    </div>
                    <div class="nav-text">Thống kê</div>
                </a>
                <a href="#" class="nav-item active">
                    <div class="nav-icon">
                        <i class="fas fa-comments"></i>
                    </div>
                    <div class="nav-text">Trò chuyện</div>
                </a>
            </div>

            <div class="sidebar-footer">
                <div class="theme-toggle">
                    <div class="theme-btn active" data-theme="light">
                        <i class="fas fa-sun"></i>
                    </div>
                    <div class="theme-btn" data-theme="dark">
                        <i class="fas fa-moon"></i>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main content -->
        <main class="main-content">
            <div class="chat-container">
                <!-- Member list -->
                <div class="member-list">
                    <div class="member-list-header">
                        <h2 class="member-list-title">Thành viên</h2>
                    </div>
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" id="searchMembers" placeholder="Tìm kiếm thành viên...">
                    </div>
                    <div class="member-scroll-container" id="memberList">
                        <!-- Members will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Chat area -->
                <div class="chat-area">
                    <div class="chat-header">
                        <div class="chat-title-container" id="chatTitleContainer">
                            <div class="chat-avatar" id="chatAvatar">GC</div>
                            <div>
                                <h2 class="chat-title" id="chatTitle">Chọn một cuộc trò chuyện</h2>
                                <div class="chat-subtitle" id="chatSubtitle"></div>
                            </div>
                        </div>
                        <div class="chat-actions">
                            <!-- Nút tìm kiếm tin nhắn -->
                            <div class="chat-action-btn" id="searchMessagesBtn" title="Tìm kiếm tin nhắn">
                                <i class="fas fa-search"></i>
                            </div>
                            
                            <!-- Nút thông tin cuộc trò chuyện -->
                            <div class="chat-action-btn" id="chatInfoBtn" title="Thông tin trò chuyện">
                                <i class="fas fa-info-circle"></i>
                            </div>
                            
                            <!-- Menu thêm tùy chọn -->
                            <div class="chat-action-btn more-actions" id="moreActionsBtn" title="Tùy chọn khác">
                                <i class="fas fa-ellipsis-v"></i>
                                
                                <!-- Dropdown menu -->
                                <div class="actions-dropdown">
                                    <div class="dropdown-item" id="clearChatBtn">
                                        <i class="fas fa-trash-alt"></i>
                                        <span>Xóa lịch sử trò chuyện</span>
                                    </div>
                                    <div class="dropdown-item" id="muteChatBtn">
                                        <i class="fas fa-bell-slash"></i>
                                        <span>Tắt thông báo</span>
                                    </div>
                                    <div class="dropdown-item" id="addMembersBtn">
                                        <i class="fas fa-user-plus"></i>
                                        <span>Thêm thành viên</span>
                                    </div>
                                    <div class="dropdown-item" id="leaveGroupBtn">
                                        <i class="fas fa-sign-out-alt"></i>
                                        <span>Rời nhóm</span>
                                    </div>
                                    <div class="dropdown-item" id="reportBtn">
                                        <i class="fas fa-flag"></i>
                                        <span>Báo cáo</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <style>
                            /* Thêm CSS cho dropdown menu */
                            .more-actions {
                                position: relative;
                            }
                            
                            .actions-dropdown {
                                position: absolute;
                                top: 100%;
                                right: 0;
                                background-color: var(--card-bg);
                                border-radius: var(--radius-md);
                                box-shadow: var(--shadow-lg);
                                width: 220px;
                                padding: 0.5rem 0;
                                z-index: 100;
                                display: none;
                                animation: fadeIn 0.2s ease;
                            }
                            
                            .more-actions:hover .actions-dropdown,
                            .more-actions:focus-within .actions-dropdown {
                                display: block;
                            }
                            
                            .dropdown-item {
                                display: flex;
                                align-items: center;
                                padding: 0.75rem 1rem;
                                cursor: pointer;
                                transition: var(--transition);
                                color: var(--text);
                            }
                            
                            .dropdown-item:hover {
                                background-color: var(--hover);
                                color: var(--primary);
                            }
                            
                            .dropdown-item i {
                                width: 24px;
                                margin-right: 0.75rem;
                                font-size: 0.9rem;
                            }
                            
                            .dropdown-item span {
                                font-size: 0.9rem;
                            }
                            
                            /* Search modal */
                            .search-modal {
                                position: fixed;
                                top: 0;
                                left: 0;
                                right: 0;
                                bottom: 0;
                                background-color: rgba(0, 0, 0, 0.5);
                                z-index: 1000;
                                display: none;
                                justify-content: center;
                                align-items: flex-start;
                                padding-top: 100px;
                            }
                            
                            
                            .search-header {
                                padding: 1rem;
                                border-bottom: 1px solid var(--border);
                                display: flex;
                                justify-content: space-between;
                                align-items: center;
                            }
                            
                            .search-header h3 {
                                font-size: 1.1rem;
                                font-weight: 600;
                            }
                            
                            .close-search {
                                background: none;
                                border: none;
                                color: var(--text-light);
                                font-size: 1.25rem;
                                cursor: pointer;
                            }
                            
                           
                            
                            .search-results {
                                padding: 1rem;
                                overflow-y: auto;
                                max-height: 60vh;
                            }
                            
                            .search-result-item {
                                padding: 0.75rem 0;
                                border-bottom: 1px solid var(--border);
                                cursor: pointer;
                            }
                            
                            .search-result-item:last-child {
                                border-bottom: none;
                            }
                            
                            .search-result-item:hover {
                                color: var(--primary);
                            }
                            
                            /* Info modal */
                            .info-modal {
                                position: fixed;
                                top: 0;
                                left: 0;
                                right: 0;
                                bottom: 0;
                                background-color: rgba(0, 0, 0, 0.5);
                                z-index: 1000;
                                display: none;
                                justify-content: center;
                                align-items: center;
                            }
                            
                            .info-container {
                                background-color: var(--card-bg);
                                border-radius: var(--radius-md);
                                width: 90%;
                                max-width: 500px;
                                max-height: 90vh;
                                overflow: hidden;
                                box-shadow: var(--shadow-lg);
                            }
                            
                            .info-header {
                                padding: 1rem;
                                border-bottom: 1px solid var(--border);
                                display: flex;
                                justify-content: space-between;
                                align-items: center;
                            }
                            
                            .info-header h3 {
                                font-size: 1.1rem;
                                font-weight: 600;
                            }
                            
                            .close-info {
                                background: none;
                                border: none;
                                color: var(--text-light);
                                font-size: 1.25rem;
                                cursor: pointer;
                            }
                            
                            .info-content {
                                padding: 1rem;
                                overflow-y: auto;
                            }
                            
                            .info-group {
                                margin-bottom: 1.5rem;
                            }
                            
                            .info-group-title {
                                font-size: 0.9rem;
                                color: var(--text-light);
                                margin-bottom: 0.75rem;
                                text-transform: uppercase;
                                letter-spacing: 0.5px;
                            }
                            
                            .info-item {
                                display: flex;
                                align-items: center;
                                padding: 0.75rem 0;
                                border-bottom: 1px solid var(--border);
                            }
                            
                            .info-item:last-child {
                                border-bottom: none;
                            }
                            
                            .info-item i {
                                width: 24px;
                                color: var(--text-light);
                                margin-right: 0.75rem;
                            }
                            
                            .info-item-content {
                                flex: 1;
                            }
                            
                            .info-item-title {
                                font-weight: 500;
                                margin-bottom: 0.25rem;
                            }
                            
                            .info-item-desc {
                                font-size: 0.85rem;
                                color: var(--text-light);
                            }
                            
                            /* Animation */
                            @keyframes fadeIn {
                                from { opacity: 0; transform: translateY(-10px); }
                                to { opacity: 1; transform: translateY(0); }
                            }
                        </style>
                        
                        <script>
                            document.addEventListener('DOMContentLoaded', function() {
                                // Lấy các phần tử DOM
                                const searchMessagesBtn = document.getElementById('searchMessagesBtn');
                                const chatInfoBtn = document.getElementById('chatInfoBtn');
                                const moreActionsBtn = document.getElementById('moreActionsBtn');
                                const clearChatBtn = document.getElementById('clearChatBtn');
                                const muteChatBtn = document.getElementById('muteChatBtn');
                                const addMembersBtn = document.getElementById('addMembersBtn');
                                const leaveGroupBtn = document.getElementById('leaveGroupBtn');
                                const reportBtn = document.getElementById('reportBtn');
                                
                                // Tạo modal tìm kiếm
                                const searchModal = document.createElement('div');
                                searchModal.className = 'search-modal';
                                searchModal.innerHTML = `
                                    <div class="search-container">
                                        <div class="search-header">
                                            <h3>Tìm kiếm tin nhắn</h3>
                                            <button class="close-search">&times;</button>
                                        </div>
                                        <div class="search-input-container">
                                            <input type="text" placeholder="Nhập từ khóa tìm kiếm..." id="searchMessageInput">
                                        </div>
                                        <div class="search-results" id="searchResults">
                                            <!-- Kết quả tìm kiếm sẽ hiển thị ở đây -->
                                        </div>
                                    </div>
                                `;
                                document.body.appendChild(searchModal);
                                
                                // Tạo modal thông tin
                                const infoModal = document.createElement('div');
                                infoModal.className = 'info-modal';
                                infoModal.innerHTML = `
                                    <div class="info-container">
                                        <div class="info-header">
                                            <h3>Thông tin trò chuyện</h3>
                                            <button class="close-info">&times;</button>
                                        </div>
                                        <div class="info-content" id="infoContent">
                                            <!-- Nội dung thông tin sẽ hiển thị ở đây -->
                                        </div>
                                    </div>
                                `;
                                document.body.appendChild(infoModal);
                                
                                // Xử lý sự kiện click nút tìm kiếm
                                searchMessagesBtn.addEventListener('click', function() {
                                    searchModal.style.display = 'flex';
                                    document.getElementById('searchMessageInput').focus();
                                });
                                
                                // Xử lý sự kiện click nút thông tin
                                chatInfoBtn.addEventListener('click', function() {
                                    // Lấy thông tin cuộc trò chuyện hiện tại
                                    const currentChat = members.find(m => m.id === selectedChat);
                                    
                                    // Tạo nội dung thông tin
                                    let infoHTML = '';
                                    
                                    if (currentChat.isGroup) {
                                        infoHTML = `
                                            <div class="info-group">
                                                <div class="info-group-title">Thông tin nhóm</div>
                                                <div class="info-item">
                                                    <i class="fas fa-users"></i>
                                                    <div class="info-item-content">
                                                        <div class="info-item-title">${currentChat.name}</div>
                                                        <div class="info-item-desc">${currentChat.members.length} thành viên</div>
                                                    </div>
                                                </div>
                                                <div class="info-item">
                                                    <i class="fas fa-calendar-alt"></i>
                                                    <div class="info-item-content">
                                                        <div class="info-item-title">Ngày tạo</div>
                                                        <div class="info-item-desc">15/03/2025</div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="info-group">
                                                <div class="info-group-title">Thành viên</div>
                                                ${currentChat.members.map(memberId => {
                                                    const member = members.find(m => m.id === memberId);
                                                    if (!member) return '';
                                                    return `
                                                        <div class="info-item">
                                                            <div class="member-avatar small">${member.avatar}</div>
                                                            <div class="info-item-content">
                                                                <div class="info-item-title">${member.name}</div>
                                                                <div class="info-item-desc">${member.isOnline ? 'Đang hoạt động' : 'Offline'}</div>
                                                            </div>
                                                        </div>
                                                    `;
                                                }).join('')}
                                            </div>
                                        `;
                                    } else {
                                        infoHTML = `
                                            <div class="info-group">
                                                <div class="info-group-title">Thông tin cá nhân</div>
                                                <div class="info-item">
                                                    <div class="member-avatar large">${currentChat.avatar}</div>
                                                    <div class="info-item-content">
                                                        <div class="info-item-title">${currentChat.name}</div>
                                                        <div class="info-item-desc">${currentChat.isOnline ? 'Đang hoạt động' : 'Offline'}</div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div class="info-group">
                                                <div class="info-group-title">Thông tin liên hệ</div>
                                                <div class="info-item">
                                                    <i class="fas fa-phone"></i>
                                                    <div class="info-item-content">
                                                        <div class="info-item-title">Số điện thoại</div>
                                                        <div class="info-item-desc">0987 654 321</div>
                                                    </div>
                                                </div>
                                                <div class="info-item">
                                                    <i class="fas fa-envelope"></i>
                                                    <div class="info-item-content">
                                                        <div class="info-item-title">Email</div>
                                                        <div class="info-item-desc">${currentChat.id}@example.com</div>
                                                    </div>
                                                </div>
                                            </div>
                                        `;
                                    }
                                    
                                    document.getElementById('infoContent').innerHTML = infoHTML;
                                    infoModal.style.display = 'flex';
                                });
                                
                                // Xử lý sự kiện click nút đóng modal
                                document.querySelector('.close-search').addEventListener('click', function() {
                                    searchModal.style.display = 'none';
                                });
                                
                                document.querySelector('.close-info').addEventListener('click', function() {
                                    infoModal.style.display = 'none';
                                });
                                
                                // Xử lý click ra ngoài modal để đóng
                                searchModal.addEventListener('click', function(e) {
                                    if (e.target === searchModal) {
                                        searchModal.style.display = 'none';
                                    }
                                });
                                
                                infoModal.addEventListener('click', function(e) {
                                    if (e.target === infoModal) {
                                        infoModal.style.display = 'none';
                                    }
                                });
                                
                                // Xử lý tìm kiếm tin nhắn
                                document.getElementById('searchMessageInput').addEventListener('input', function() {
                                    const searchTerm = this.value.toLowerCase();
                                    const resultsContainer = document.getElementById('searchResults');
                                    
                                    if (!searchTerm) {
                                        resultsContainer.innerHTML = '<div style="padding: 1rem; text-align: center; color: var(--text-light);">Nhập từ khóa để tìm kiếm tin nhắn</div>';
                                        return;
                                    }
                                    
                                    if (!selectedChat) {
                                        resultsContainer.innerHTML = '<div style="padding: 1rem; text-align: center; color: var(--text-light);">Không có cuộc trò chuyện nào được chọn</div>';
                                        return;
                                    }
                                    
                                    const foundMessages = messages[selectedChat].filter(msg => 
                                        msg.content.toLowerCase().includes(searchTerm)
                                    );
                                    
                                    if (foundMessages.length === 0) {
                                        resultsContainer.innerHTML = '<div style="padding: 1rem; text-align: center; color: var(--text-light);">Không tìm thấy tin nhắn phù hợp</div>';
                                        return;
                                    }
                                    
                                    resultsContainer.innerHTML = foundMessages.map(msg => {
                                        const isSent = msg.sender.id === currentUser.id;
                                        const time = formatTime(new Date(msg.timestamp));
                                        
                                        return `
                                            <div class="search-result-item" data-id="${msg.id}">
                                                <div style="font-size: 0.85rem; color: var(--text-light); margin-bottom: 0.25rem;">
                                                    ${isSent ? 'Bạn' : msg.sender.name} • ${time}
                                                </div>
                                                <div>${highlightSearchTerm(msg.content, searchTerm)}</div>
                                            </div>
                                        `;
                                    }).join('');
                                    
                                    // Thêm sự kiện click cho kết quả tìm kiếm
                                    document.querySelectorAll('.search-result-item').forEach(item => {
                                        item.addEventListener('click', function() {
                                            const messageId = this.getAttribute('data-id');
                                            scrollToMessage(messageId);
                                            searchModal.style.display = 'none';
                                        });
                                    });
                                });
                                
                                // Hàm highlight từ khóa tìm kiếm
                                function highlightSearchTerm(text, term) {
                                    if (!term) return text;
                                    const regex = new RegExp(term, 'gi');
                                    return text.replace(regex, match => `<span style="background-color: rgba(255, 109, 40, 0.3);">${match}</span>`);
                                }
                                
                                // Hàm cuộn đến tin nhắn cụ thể
                                function scrollToMessage(messageId) {
                                    const messageElement = document.querySelector(`[data-message-id="${messageId}"]`);
                                    if (messageElement) {
                                        messageElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                        messageElement.style.animation = 'highlight 1.5s';
                                        
                                        // Xóa animation sau khi hoàn thành
                                        setTimeout(() => {
                                            messageElement.style.animation = '';
                                        }, 1500);
                                    }
                                }
                                
                                // Thêm CSS cho highlight
                                const style = document.createElement('style');
                                style.textContent = `
                                    @keyframes highlight {
                                        0% { background-color: rgba(255, 109, 40, 0); }
                                        50% { background-color: rgba(255, 109, 40, 0.2); }
                                        100% { background-color: rgba(255, 109, 40, 0); }
                                    }
                                    
                                    .member-avatar.small {
                                        width: 32px;
                                        height: 32px;
                                        font-size: 0.9rem;
                                        margin-right: 0.75rem;
                                    }
                                    
                                    .member-avatar.large {
                                        width: 60px;
                                        height: 60px;
                                        font-size: 1.5rem;
                                        margin-right: 1rem;
                                    }
                                `;
                                document.head.appendChild(style);
                                
                                // Xử lý các tùy chọn trong dropdown menu
                                clearChatBtn.addEventListener('click', function() {
                                    if (confirm('Bạn có chắc chắn muốn xóa toàn bộ lịch sử trò chuyện này?')) {
                                        if (selectedChat) {
                                            messages[selectedChat] = [];
                                            renderMessages();
                                            
                                            // Cập nhật last message trong danh sách
                                            const member = members.find(m => m.id === selectedChat);
                                            member.lastMessage = '';
                                            member.time = '';
                                            renderMemberList();
                                        }
                                    }
                                });
                                
                                muteChatBtn.addEventListener('click', function() {
                                    const member = members.find(m => m.id === selectedChat);
                                    if (member) {
                                        member.isMuted = !member.isMuted;
                                        alert(`Đã ${member.isMuted ? 'tắt' : 'bật'} thông báo cho cuộc trò chuyện với ${member.name}`);
                                    }
                                });
                                
                                addMembersBtn.addEventListener('click', function() {
                                    if (selectedChat) {
                                        const member = members.find(m => m.id === selectedChat);
                                        if (member && member.isGroup) {
                                            alert('Chức năng thêm thành viên vào nhóm sẽ được mở sau');
                                        } else {
                                            alert('Chỉ có thể thêm thành viên vào nhóm trò chuyện');
                                        }
                                    }
                                });
                                
                                leaveGroupBtn.addEventListener('click', function() {
                                    if (selectedChat) {
                                        const member = members.find(m => m.id === selectedChat);
                                        if (member && member.isGroup) {
                                            if (confirm(`Bạn có chắc chắn muốn rời nhóm ${member.name}?`)) {
                                                alert('Bạn đã rời khỏi nhóm thành công');
                                                // Xử lý logic rời nhóm ở đây
                                            }
                                        } else {
                                            alert('Chỉ có thể rời khỏi nhóm trò chuyện');
                                        }
                                    }
                                });
                                
                                reportBtn.addEventListener('click', function() {
                                    if (selectedChat) {
                                        const member = members.find(m => m.id === selectedChat);
                                        const reportReason = prompt(`Nhập lý do báo cáo ${member.name}:`);
                                        if (reportReason) {
                                            alert(`Đã gửi báo cáo về ${member.name} với lý do: ${reportReason}`);
                                        }
                                    }
                                });
                            });
                        </script>
                    </div>
                    
                    <div class="chat-messages-container">
                        <div class="chat-messages" id="chatMessages">
                            <div class="empty-state">
                                <div class="empty-icon">
                                    <i class="fas fa-comment-dots"></i>
                                </div>
                                <h3 class="empty-title">Chưa có cuộc trò chuyện nào được chọn</h3>
                                <p class="empty-text">Chọn một thành viên từ danh sách bên trái để bắt đầu trò chuyện hoặc tạo nhóm mới</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="chat-input-container">
                        <div class="message-input-container">
                            <i class="fas fa-paperclip attachment-btn" title="Đính kèm"></i>
                            <textarea class="chat-input" id="messageInput" placeholder="Nhập tin nhắn..." rows="1"></textarea>
                            <button class="send-btn" id="sendMessage" disabled>
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                        <div class="input-actions">
                            <div class="input-action">
                                <i class="fas fa-image"></i>
                                <span>Ảnh</span>
                            </div>
                            <div class="input-action">
                                <i class="fas fa-file"></i>
                                <span>Tệp</span>
                            </div>
                            <div class="input-action">
                                <i class="fas fa-money-bill-wave"></i>
                                <span>Chi phí</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Mobile menu toggle
            const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
            const sidebar = document.querySelector('.sidebar');
            
            mobileMenuBtn.addEventListener('click', function() {
                sidebar.classList.toggle('active');
                mobileMenuBtn.innerHTML = sidebar.classList.contains('active') 
                    ? '<i class="fas fa-times"></i>' 
                    : '<i class="fas fa-bars"></i>';
            });

            // Theme toggle
            const themeToggle = document.querySelector('.theme-toggle');
            const themeBtns = document.querySelectorAll('.theme-btn');
            const body = document.body;
            const themeIcon = document.querySelector('.theme-icon i');
            
            themeBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const theme = this.getAttribute('data-theme');
                    
                    themeBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    body.setAttribute('data-theme', theme);
                    localStorage.setItem('theme', theme);
                    
                    themeIcon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
                });
            });

            const savedTheme = localStorage.getItem('theme') || 'light';
            body.setAttribute('data-theme', savedTheme);
            
            const activeThemeBtn = document.querySelector(`.theme-btn[data-theme="${savedTheme}"]`);
            if (activeThemeBtn) {
                themeBtns.forEach(b => b.classList.remove('active'));
                activeThemeBtn.classList.add('active');
                themeIcon.className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
            }

            // Auto-resize textarea
            const messageInput = document.getElementById('messageInput');
            
            messageInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
                
                // Enable/disable send button based on input
                document.getElementById('sendMessage').disabled = this.value.trim() === '';
            });

            // Chat page functionality
            const searchMembers = document.getElementById('searchMembers');
            const memberList = document.getElementById('memberList');
            const chatTitleContainer = document.getElementById('chatTitleContainer');
            const chatAvatar = document.getElementById('chatAvatar');
            const chatTitle = document.getElementById('chatTitle');
            const chatSubtitle = document.getElementById('chatSubtitle');
            const chatMessages = document.getElementById('chatMessages');
            const sendMessage = document.getElementById('sendMessage');

            let currentUser = { 
                id: 'nguyen_minh', 
                name: 'Nguyễn Minh', 
                avatar: 'NM' 
            };
            
            let selectedChat = null;
            let typingTimeout = null;

            // Sample data
            const members = [
                { 
                    id: 'group', 
                    name: 'Nhóm Nhà Mình A2', 
                    avatar: 'GC',
                    lastMessage: 'Minh: Cơm gà với canh chua đi!',
                    time: '10:05',
                    unread: 2,
                    isGroup: true,
                    members: ['nguyen_minh', 'tran_huong', 'le_anh', 'pham_tuan']
                },
                { 
                    id: 'tran_huong', 
                    name: 'Trần Hương', 
                    avatar: 'TH',
                    lastMessage: 'OK, chiều mình mua.',
                    time: '12:10',
                    unread: 1,
                    isOnline: true
                },
                { 
                    id: 'le_anh', 
                    name: 'Lê Anh', 
                    avatar: 'LA',
                    lastMessage: 'Cảm ơn bạn nhé!',
                    time: '09:30',
                    unread: 0,
                    isOnline: false
                },
                { 
                    id: 'pham_tuan', 
                    name: 'Phạm Tuấn', 
                    avatar: 'PT',
                    lastMessage: 'Mình sẽ đi chợ lúc 5h',
                    time: 'Hôm qua',
                    unread: 0,
                    isOnline: true
                }
            ];

            const messages = {
                group: [
                    { 
                        id: 'msg1',
                        sender: { id: 'tran_huong', name: 'Trần Hương', avatar: 'TH' }, 
                        content: 'Mọi người ơi, mai nấu gì?', 
                        timestamp: '2025-04-29T10:00:00', 
                        isRead: true
                    },
                    { 
                        id: 'msg2',
                        sender: { id: 'nguyen_minh', name: 'Nguyễn Minh', avatar: 'NM' }, 
                        content: 'Cơm gà với canh chua đi!', 
                        timestamp: '2025-04-29T10:05:00',
                        isRead: true
                    },
                    { 
                        id: 'msg3',
                        sender: { id: 'le_anh', name: 'Lê Anh', avatar: 'LA' }, 
                        content: 'Mình đồng ý, món đó ngon mà dễ nấu', 
                        timestamp: '2025-04-29T10:07:00',
                        isRead: true
                    },
                    { 
                        id: 'msg4',
                        sender: { id: 'pham_tuan', name: 'Phạm Tuấn', avatar: 'PT' }, 
                        content: 'Ai đi chợ mua đồ nhỉ?', 
                        timestamp: '2025-04-29T10:10:00',
                        isRead: true
                    }
                ],
                tran_huong: [
                    { 
                        id: 'msg1',
                        sender: { id: 'tran_huong', name: 'Trần Hương', avatar: 'TH' }, 
                        content: 'Minh ơi, mua thêm muối nhé!', 
                        timestamp: '2025-04-29T12:00:00',
                        isRead: true
                    },
                    { 
                        id: 'msg2',
                        sender: { id: 'nguyen_minh', name: 'Nguyễn Minh', avatar: 'NM' }, 
                        content: 'OK, chiều mình mua.', 
                        timestamp: '2025-04-29T12:10:00',
                        isRead: true
                    },
                    { 
                        id: 'msg3',
                        sender: { id: 'tran_huong', name: 'Trần Hương', avatar: 'TH' }, 
                        content: 'Cảm ơn bạn 😊', 
                        timestamp: '2025-04-29T12:12:00',
                        isRead: true
                    }
                ],
                le_anh: [
                    { 
                        id: 'msg1',
                        sender: { id: 'le_anh', name: 'Lê Anh', avatar: 'LA' }, 
                        content: 'Minh ơi, cho mình mượn nồi chiên không khí nhé', 
                        timestamp: '2025-04-28T09:00:00',
                        isRead: true
                    },
                    { 
                        id: 'msg2',
                        sender: { id: 'nguyen_minh', name: 'Nguyễn Minh', avatar: 'NM' }, 
                        content: 'Được thôi, tối nay mình mang qua cho', 
                        timestamp: '2025-04-28T09:05:00',
                        isRead: true
                    },
                    { 
                        id: 'msg3',
                        sender: { id: 'le_anh', name: 'Lê Anh', avatar: 'LA' }, 
                        content: 'Cảm ơn bạn nhé!', 
                        timestamp: '2025-04-28T09:30:00',
                        isRead: true
                    }
                ],
                pham_tuan: []
            };

            // Simulate typing indicator
            function showTypingIndicator(chatId) {
                if (selectedChat === chatId) {
                    const typingDiv = document.createElement('div');
                    typingDiv.className = 'typing-indicator fade-in';
                    typingDiv.id = 'typingIndicator';
                    typingDiv.innerHTML = `
                        <div class="typing-dots">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                        <span style="margin-left: 0.5rem; font-size: 0.85rem; color: var(--text-light);">đang nhập...</span>
                    `;
                    chatMessages.appendChild(typingDiv);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    
                    // Clear previous timeout if exists
                    if (typingTimeout) clearTimeout(typingTimeout);
                    
                    // Hide typing indicator after 3 seconds
                    typingTimeout = setTimeout(() => {
                        const indicator = document.getElementById('typingIndicator');
                        if (indicator) {
                            indicator.remove();
                        }
                    }, 3000);
                }
            }

            // Simulate received message
            function simulateReceivedMessage(chatId) {
                if (selectedChat === chatId) {
                    showTypingIndicator(chatId);
                    
                    setTimeout(() => {
                        const indicator = document.getElementById('typingIndicator');
                        if (indicator) {
                            indicator.remove();
                        }
                        
                        const member = members.find(m => m.id === chatId);
                        const newMessage = {
                            id: 'msg' + Date.now(),
                            sender: { 
                                id: chatId, 
                                name: member.name, 
                                avatar: member.avatar 
                            },
                            content: getRandomResponse(),
                            timestamp: new Date().toISOString(),
                            isRead: false
                        };
                        
                        if (!messages[chatId]) messages[chatId] = [];
                        messages[chatId].push(newMessage);
                        
                        // Update last message in member list
                        member.lastMessage = newMessage.content.length > 20 
                            ? newMessage.content.substring(0, 20) + '...' 
                            : newMessage.content;
                        member.time = formatTimeShort(new Date());
                        
                        renderMessages();
                        
                        // Mark as read immediately since we're in the chat
                        newMessage.isRead = true;
                    }, 3000);
                } else {
                    // If not in the chat, just update the member list
                    const member = members.find(m => m.id === chatId);
                    member.unread += 1;
                    member.lastMessage = getRandomResponse().substring(0, 20) + '...';
                    member.time = formatTimeShort(new Date());
                    renderMemberList();
                }
            }

            function getRandomResponse() {
                const responses = [
                    "Đồng ý nhé!",
                    "Mình sẽ làm ngay.",
                    "Cảm ơn bạn!",
                    "Chiều mình đi chợ mua nhé.",
                    "Bạn có thể gửi lại công thức được không?",
                    "Món đó ngon đấy!",
                    "Mình rảnh tối nay nè.",
                    "Nhớ mua thêm ít rau nhé.",
                    "Bạn định nấu món gì thế?",
                    "Mình vừa mới thử công thức mới, ngon lắm!"
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }

            function renderMemberList() {
                const searchTerm = searchMembers.value.toLowerCase();
                memberList.innerHTML = '';
                
                // Sort members by time (most recent first)
                const sortedMembers = [...members].sort((a, b) => {
                    return new Date(b.time) - new Date(a.time);
                });
                
                sortedMembers
                    .filter(member => member.name.toLowerCase().includes(searchTerm))
                    .forEach(member => {
                        const memberItem = document.createElement('div');
                        memberItem.className = `member-item ${selectedChat === member.id ? 'active' : ''}`;
                        memberItem.dataset.id = member.id;
                        memberItem.innerHTML = `
                            <div class="member-avatar">${member.avatar}</div>
                            <div class="member-info">
                                <div class="member-name">${member.name}</div>
                                <div class="member-last-msg">${member.lastMessage || 'Bắt đầu trò chuyện'}</div>
                            </div>
                            <div class="member-meta">
                                <div class="member-time">${member.time || ''}</div>
                                ${member.unread > 0 ? `<div class="member-badge">${member.unread}</div>` : ''}
                            </div>
                        `;
                        memberItem.addEventListener('click', () => {
                            selectedChat = member.id;
                            chatAvatar.textContent = member.avatar;
                            chatTitle.textContent = member.name;
                            
                            if (member.isGroup) {
                                chatSubtitle.textContent = `${member.members.length} thành viên`;
                            } else {
                                chatSubtitle.textContent = member.isOnline ? 'Đang hoạt động' : 'Offline';
                            }
                            
                            renderMessages();
                            
                            // Reset unread count
                            members.find(m => m.id === member.id).unread = 0;
                            renderMemberList();
                            
                            // Mark all messages as read
                            if (messages[member.id]) {
                                messages[member.id].forEach(msg => msg.isRead = true);
                            }
                            
                            // Auto-focus input
                            messageInput.focus();
                        });
                        memberList.appendChild(memberItem);
                    });
            }

            function renderMessages() {
                if (!selectedChat) {
                    chatMessages.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon">
                                <i class="fas fa-comment-dots"></i>
                            </div>
                            <h3 class="empty-title">Chưa có cuộc trò chuyện nào được chọn</h3>
                            <p class="empty-text">Chọn một thành viên từ danh sách bên trái để bắt đầu trò chuyện hoặc tạo nhóm mới</p>
                        </div>
                    `;
                    return;
                }

                chatMessages.innerHTML = '';
                
                const chatMessagesList = messages[selectedChat] || [];
                let currentDate = null;
                
                if (chatMessagesList.length === 0) {
                    chatMessages.innerHTML = `
                        <div class="empty-state" style="height: 100%; justify-content: center;">
                            <div class="empty-icon">
                                <i class="fas fa-comments"></i>
                            </div>
                            <h3 class="empty-title">Bắt đầu cuộc trò chuyện với ${members.find(m => m.id === selectedChat).name}</h3>
                            <p class="empty-text">Gửi tin nhắn đầu tiên để bắt đầu trò chuyện</p>
                        </div>
                    `;
                    return;
                }
                
                chatMessagesList.forEach((msg, index) => {
                    const messageDate = new Date(msg.timestamp);
                    const messageDay = messageDate.toDateString();
                    
                    // Add date separator if needed
                    if (!currentDate || currentDate !== messageDay) {
                        currentDate = messageDay;
                        const dateDiv = document.createElement('div');
                        dateDiv.className = 'message-date';
                        dateDiv.innerHTML = `<span>${formatDate(messageDate)}</span>`;
                        chatMessages.appendChild(dateDiv);
                    }
                    
                    const isSent = msg.sender.id === currentUser.id;
                    const message = document.createElement('div');
                    message.className = `message ${isSent ? 'sent' : 'received'} fade-in`;
                    message.style.animationDelay = `${index * 0.05}s`;
                    
                    let statusIcon = '';
                    if (isSent) {
                        statusIcon = msg.isRead 
                            ? '<i class="fas fa-check-double message-status" title="Đã xem"></i>' 
                            : '<i class="fas fa-check message-status" title="Đã gửi"></i>';
                    }
                    
                    message.innerHTML = `
                        ${!isSent ? `<div class="message-sender">${msg.sender.name}</div>` : ''}
                        <div>${msg.content}</div>
                        <div class="message-timestamp">
                            ${formatTime(messageDate)}
                            ${statusIcon}
                        </div>
                    `;
                    chatMessages.appendChild(message);
                });
                
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            function formatDate(date) {
                const today = new Date();
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                
                if (date.toDateString() === today.toDateString()) {
                    return 'Hôm nay';
                } else if (date.toDateString() === yesterday.toDateString()) {
                    return 'Hôm qua';
                } else {
                    return date.toLocaleDateString('vi-VN', { 
                        weekday: 'long', 
                        day: 'numeric', 
                        month: 'numeric' 
                    });
                }
            }

            function formatTime(date) {
                return date.toLocaleTimeString('vi-VN', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
            }

            function formatTimeShort(date) {
                const now = new Date();
                const diffDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));
                
                if (diffDays === 0) {
                    return formatTime(date);
                } else if (diffDays === 1) {
                    return 'Hôm qua';
                } else if (diffDays < 7) {
                    return date.toLocaleDateString('vi-VN', { weekday: 'short' });
                } else {
                    return date.toLocaleDateString('vi-VN', { 
                        day: 'numeric', 
                        month: 'numeric' 
                    });
                }
            }

            // Event listeners
            searchMembers.addEventListener('input', renderMemberList);

            sendMessage.addEventListener('click', sendNewMessage);
            
            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendNewMessage();
                }
            });

            function sendNewMessage() {
                const content = messageInput.value.trim();
                if (content && selectedChat) {
                    const newMessage = {
                        id: 'msg' + Date.now(),
                        sender: currentUser,
                        content,
                        timestamp: new Date().toISOString(),
                        isRead: false
                    };
                    
                    if (!messages[selectedChat]) messages[selectedChat] = [];
                    messages[selectedChat].push(newMessage);
                    
                    // Update last message in member list
                    const member = members.find(m => m.id === selectedChat);
                    member.lastMessage = content.length > 20 
                        ? content.substring(0, 20) + '...' 
                        : content;
                    member.time = formatTimeShort(new Date());
                    
                    messageInput.value = '';
                    messageInput.style.height = 'auto';
                    sendMessage.disabled = true;
                    
                    renderMessages();
                    renderMemberList();
                    
                    // Simulate received message after 2-5 seconds
                    setTimeout(() => {
                        simulateReceivedMessage(selectedChat);
                    }, 2000 + Math.random() * 3000);
                }
            }

            // Initialize
            renderMemberList();
            
            // Auto-select first member for demo
            setTimeout(() => {
                if (memberList.firstChild) {
                    memberList.firstChild.click();
                }
            }, 500);
        });
    </script>
</body>
</html>